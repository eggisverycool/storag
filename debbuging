local json = '{"SpawnPoint": {"Iron": "2"}, "Electromagnet": {"Iron": "10", "Copper": "20", "Wire": "100"}, "FactionSpawn": {"SpawnPoint": "10", "Diamond": "5"}, "Igniter": {"Iron": "10", "Plastic": "5", "Wire": "2"}, "RepairKit": {"Iron": "5"}, "Boombox": {"Wire": "5", "Gear": "6", "Cloth": "4", "Pipe": "3", "Motor": "4", "Iron": "4", "Copper": "2", "Glass": "2", "Quartz": "1"}, "SolarPanel": {"Iron": "4", "Silicon": "7", "Quartz": "40", "Wire": "10"}, "HyperDrive": {"Iron": "100", "IonRocket": "3", "Wire": "50"}, "RoundTemplate2": {"Stone": "1"}, "Balloon": {"Iron": "1", "Cloth": "3", "Rubber": "2"}, "CrossBow": {"Stick": "2", "Cloth": "1"}, "Hologram": {"Iron": "15", "Diamond": "5", "Quartz": "25"}, "Reactor": {"Rubber": "30", "Wire": "15", "Iron": "50", "Pipe": "25", "Quartz": "10"}, "PowerCell": {"Iron": "1", "Sulfur": "1", "Wire": "1"}, "SteamEngine": {"Pipe": "4", "Iron": "4"}, "Telescope": {"Iron": "10", "Glass": "5", "Wire": "15"}, "Gyro": {"Iron": "8", "Wire": "4"}, "GravityGenerator": {"Wire": "150", "Engine": "30", "Pipe": "20", "Quartz": "40"}, "Boiler": {"Iron": "10", "Pipe": "25", "Heater": "5", "Wire": "5"}, "Controller": {"TriggerWire": "4", "Iron": "2"}, "DoorTemplate": {"Stone": "1"}, "DeleteSwitch": {"Copper": "1", "Silicon": "1"}, "Microphone": {"Copper": "2", "Silicon": "2"}, "Decoupler": {"Iron": "12"}, "ZapWire": {"TriggerWire": "1", "TouchSensor": "1", "Flint": "1", "Wire": "1", "PowerCell": "1"}, "VehicleSeat": {"Rubber": "2", "Wood": "3"}, "TouchSensor": {"TriggerWire": "2", "Button": "1"}, "BallTemplate": {"Stone": "1"}, "EnergyShield": {"Iron": "200", "Silicon": "90", "Aluminum": "50", "Quartz": "75"}, "Treads": {"Rubber": "2", "Engine": "2", "Gear": "16"}, "Goo": {"Sand": "5", "Grass": "5"}, "Asphalt": {"Water": "1", "Stone": "10"}, "RTG": {"Wire": "2", "ExoticMatter": "15", "Aluminum": "3"}, "Cement": {"Sand": "2", "Stone": "2"}, "Plutonium": {"NuclearWaste": "2"}, "Katana": {"Iron": "3", "Stick": "1", "Rubber": "1"}, "Transporter": {"Antenna": "2", "Chute": "15", "Quartz": "25"}, "Anchor": {"Iron": "18"}, "Artillery": {"Iron": "24", "Sulfur": "8", "Flint": "8", "Rubber": "5"}, "SMG": {"Explosive": "3", "Iron": "140", "Rubber": "90"}, "CrudeWing": {"Stick": "3", "Cloth": "2"}, "Rotor": {"Iron": "12", "Copper": "16"}, "Button": {"Copper": "1", "Stone": "1"}, "PlasmaCannon": {"Explosive": "50", "Silicon": "90", "Iron": "200", "Uranium": "5", "Aluminum": "30"}, "Cleat": {"Cloth": "2", "Rubber": "5"}, "Apparel": {"Rubber": "5", "Cloth": "10"}, "WedgeTemplate": {"Stone": "1"}, "Fireworks": {"Cloth": "10", "Sulfur": "20"}, "Sail": {"Stick": "1", "Cloth": "1"}, "AirSupply": {"Container": "2", "Motor": "4", "Pipe": "20"}, "Rifle": {"Explosive": "5", "Iron": "100", "Wood": "50"}, "Transformer": {"Iron": "1", "Copper": "5", "Quartz": "3"}, "Extractor": {"Iron": "4"}, "Warhead": {"TriggerWire": "1", "PlutoniumCore": "1", "Uranium": "800", "BlastingCap": "6", "Explosive": "15", "Primer": "70", "EnergyBomb": "3", "Iron": "100", "Reactor": "75"}, "Tire": {"Iron": "1", "Rubber": "2"}, "Brick": {"Sand": "1", "Stone": "1", "Water": "1"}, "Keyboard": {"Quartz": "4", "Silicon": "5", "Button": "10"}, "Flashlight": {"Iron": "2", "Light": "1"}, "Prosthetic": {"Iron": "25", "Quartz": "25", "Rubber": "25", "Wire": "25"}, "StarMap": {"Radar": "2", "Wire": "20", "Quartz": "25"}, "Chute": {"Iron": "1"}, "CornerRoundTemplate": {"Stone": "1"}, "Aerogel": {"Water": "1", "Silicon": "2"}, "Missile": {"Iron": "4", "Sulfur": "20", "TriggerWire": "1"}, "Freezer": {"Iron": "10", "Cooler": "2", "Wire": "5"}, "ImpulseCannon": {"Iron": "20", "Rubber": "20", "Gear": "5"}, "Cloth": {"Grass": "2"}, "Heater": {"Wire": "2"}, "LightTube": {"Glass": "2", "Wire": "2"}, "Plastic": {"Coal": "1", "Petroleum": "1"}, "Sign": {"Iron": "1", "Cloth": "1"}, "WirelessButton": {"Quartz": "12", "Button": "1"}, "IonRocket": {"PowerCell": "5", "Engine": "10", "Pipe": "25", "Wire": "15"}, "Speaker": {"Iron": "4", "Motor": "2", "Wire": "3", "Cloth": "4"}, "TintedGlass": {"Glass": "1", "Flint": "2"}, "Container": {"Iron": "2", "Rubber": "1"}, "RemoteControl": {"Antenna": "1", "TriggerWire": "1"}, "Marble": {"Quartz": "1", "Stone": "2"}, "Propeller": {"Iron": "3", "Copper": "4"}, "Rubber": {"Grass": "1", "Stone": "1"}, "MustardGas": {"Sulfur": "3"}, "FireWood": {"Wood": "2"}, "Battery": {"Wire": "1", "Sulfur": "1"}, "Hydroponic": {"Container": "2", "Iron": "20", "Cooler": "2", "Wire": "10"}, "ChemicalSynthiser": null, "RegionCloaker": {"PowerCell": "100", "Iron": "250", "Ruby": "500"}, "LightBridge": {"Diamond": "15", "Jade": "15", "Quartz": "15", "Ruby": "15", "Aluminum": "30"}, "Filter": {"Rubber": "1", "Chute": "1"}, "TemperatureSensor": {"Iron": "1", "TriggerWire": "1", "Polysilicon": "2"}, "Microcontroller": {"Iron": "5", "Copper": "5", "Silicon": "5", "Quartz": "5"}, "Valve": {"Pipe": "1", "Rubber": "1"}, "Modem": {"Quartz": "50", "Relay": "1", "Wire": "25"}, "Torch": {"Coal": "1", "Wood": "2"}, "VintagePlasmaPistol": {"Gear": "3", "Plastic": "100", "EnergyBomb": "5", "EnergyGun": "1", "Jade": "10", "Titanium": "20", "Uranium": "15", "Aluminum": "50"}, "GeigerCounter": {"Iron": "5", "Wire": "5"}, "Disk": {"Silicon": "4", "Copper": "3", "Quartz": "10"}, "DarkConverter": {"Reactor": "5", "AlienCore": "10", "Gold": "100", "Titanium": "50", "Diamond": "25"}, "Pump": {"Iron": "2", "Container": "1", "Quartz": "1"}, "ElectricFence": {"Fence": "5", "ZapWire": "2"}, "BurnerGenerator": {"Iron": "3", "Wire": "2"}, "Coupler": {"Iron": "10"}, "Tool": {"Neutronium": "70", "Uranium": "50", "DarkMatter": "20"}, "Thruster": {"Motor": "1", "Pipe": "20", "Wire": "25"}, "Relay": {"Transporter": "5", "Antenna": "5", "Quartz": "100"}, "Seat": {"Rubber": "1", "Wood": "2"}, "Fence": {"Pipe": "4"}, "MiningLaser": {"Laser": "2", "Extractor": "5", "Aluminum": "5"}, "Wire": {"Copper": "1"}, "NightVisionGoggles": {"Iron": "1", "Ruby": "1", "Glass": "2", "Wire": "1"}, "Hotdog": {"Food": "1"}, "Pistol": {"Explosive": "3", "Iron": "70", "Rubber": "20"}, "Faucet": {"Pipe": "1", "Rubber": "1"}, "Neon": {"ZapWire": "1"}, "AutomaticLaser": {"Iron": "200", "Explosive": "50", "Silicon": "90", "Jade": "25"}, "TrussTemplate": {"Stone": "1"}, "EthernetCable": {"Copper": "1"}, "Engine": {"Pipe": "2", "Iron": "2"}, "Pipe": {"Iron": "1"}, "Wing": {"Iron": "4", "Pipe": "1"}, "Dispenser": {"Rubber": "1", "Chute": "1"}, "EnergySword": {"Diamond": "1", "Ruby": "8", "ZapWire": "3", "Titanium": "5", "Rubber": "2"}, "ReinforcedGlass": {"Glass": "5", "Iron": "5"}, "Cannon": {"Iron": "12", "Sulfur": "4", "Flint": "4"}, "Motor": {"Wire": "3", "Engine": "1"}, "Laser": {"Iron": "25", "Diamond": "50", "Ruby": "50"}, "Pulverizer": {"Iron": "4", "Gear": "3", "Wire": "1"}, "Explosive": {"Cloth": "10", "Sulfur": "40"}, "Teleporter": {"Transporter": "1", "Quartz": "50", "HyperDrive": "1", "Wire": "30"}, "Claymore": {"Iron": "3", "Stick": "1", "Rubber": "1"}, "EnergyGun": {"Glass": "20", "Ruby": "10", "Aluminum": "5"}, "TimeSensor": {"Iron": "1", "TriggerWire": "1", "Polysilicon": "2"}, "DriveBox": {"Iron": "5", "Quartz": "5"}, "Polysilicon": {"TriggerWire": "1", "Quartz": "1"}, "BallastTank": {"Iron": "1", "Rubber": "1", "Aluminum": "1"}, "ScubaMask": {"Glass": "3", "Rubber": "2"}, "Camera": {"Iron": "2", "Silicon": "2", "Wire": "2", "Quartz": "1"}, "Antenna": {"Wire": "5", "Silicon": "10", "Quartz": "15"}, "CornerTetraTemplate": {"Stone": "1"}, "BeamRifle": {"Ruby": "2", "EnergyBomb": "5", "Titanium": "30", "Diamond": "10", "Aluminum": "50"}, "BlastingCap": {"TriggerWire": "25", "Silicon": "25", "Iron": "25", "Gear": "2"}, "CloningBay": {"Iron": "25", "SpawnPoint": "1", "PowerCell": "2"}, "Constructor": {"Assembler": "5", "Copper": "10"}, "Assembler": {"Iron": "2", "Gear": "3", "Wire": "2"}, "HullTemplate": {"Stone": "1"}, "TriggerSwitch": {"Copper": "1", "Silicon": "1"}, "Handle": {"Rubber": "2", "Wood": "2"}, "StudAligner": {"Iron": "5"}, "Flamethrower": {"Iron": "24", "Sulfur": "8", "Flint": "8", "Rubber": "5"}, "SolarScoop": {"Bin": "100", "AlienCore": "15", "MiningLaser": "25", "Ruby": "500", "Reactor": "5"}, "Radar": {"Antenna": "2", "Iron": "2"}, "Gun": {"Iron": "6", "Sulfur": "12"}, "LifeSensor": {"Quartz": "25", "Grass": "15", "Wire": "5"}, "SteamTurbine": {"Wire": "10", "Gear": "5", "Engine": "3", "Iron": "20", "Pipe": "25"}, "BurstLaser": {"Iron": "100", "Explosive": "50", "Silicon": "90", "Jade": "25"}, "Kiln": {"Iron": "10", "Heater": "2", "Wire": "5"}, "TriggerWire": {"Flint": "1", "Wire": "1"}, "Instrument": {"Iron": "1"}, "CylinderTemplate": {"Stone": "1"}, "Port": {"Copper": "2", "Silicon": "2"}, "TetrahedronTemplate": {"Stone": "1"}, "Tile": {"Rubber": "1", "Stone": "2"}, "CombustionTurbine": {"Wire": "10", "Gear": "5", "Engine": "3", "Iron": "20", "Pipe": "25"}, "WaterCooler": {"Container": "1", "Copper": "4", "Pipe": "10", "Water": "50"}, "Obamium": {"Grass": "1"}, "Switch": {"Rubber": "2", "Wire": "1"}, "FluidProjector": {"Iron": "100", "Pipe": "500", "Wire": "50"}, "Rail": {"Wire": "3", "Rubber": "4", "Gear": "5"}, "Cooler": {"Wire": "2"}, "Melter": {"Iron": "10", "Heater": "2", "Wire": "5"}, "Framewire": {"ExoticMatter": "5"}, "BladeTemplate": {"Stone": "1"}, "CornerTemplate": {"Stone": "1"}, "Bin": {"Iron": "3"}, "EnergyBomb": {"Explosive": "5", "BlastingCap": "2", "Quartz": "100"}, "Screen": {"Silicon": "3", "Iron": "3", "Copper": "3", "Light": "5", "Quartz": "3"}, "Primer": {"TriggerWire": "50", "Silicon": "100", "Titanium": "25", "Wire": "10"}, "StasisField": {"PowerCell": "100", "Iron": "250", "Ruby": "500"}, "Obelisk": {"Iron": "500", "AlienCore": "10", "Diamond": "250", "Wire": "50"}, "Refinery": {"Iron": "20", "Pipe": "40", "Gear": "10"}, "CornerRoundTemplate2": {"Stone": "1"}, "RoundTemplate": {"Stone": "1"}, "PlutoniumCore": {"Plutonium": "50", "Beryllium": "350"}, "TouchScreen": {"Silicon": "3", "Screen": "1", "TouchTrigger": "1", "Iron": "2", "Copper": "4"}, "Gear": {"Iron": "1"}, "Hatch": {"Rubber": "1", "Chute": "1"}, "Railgun": {"AlienCore": "5", "Transformer": "60", "Rail": "1", "Titanium": "300", "Gun": "50", "Diamond": "30"}, "BlackBox": {"Diamond": "5", "Instrument": "75", "Antenna": "250"}, "DelayWire": {"TriggerWire": "1", "Rubber": "1"}, "Pulley": {"Cloth": "2", "Wood": "5"}, "FingerprintSensor": {"Silicon": "2", "Copper": "2", "Button": "2"}, "FloatDevice": {"Iron": "50", "Wire": "50", "Quartz": "50"}, "Lantern": {"Iron": "2", "Light": "1"}, "Spotlight": {"Iron": "1", "Glass": "1", "Wire": "2"}, "Food": {"Grass": "4"}, "DarkReactor": {"Reactor": "5", "AlienCore": "10", "Gold": "100", "Titanium": "50", "Diamond": "25"}, "ConveyorBelt": {"Wire": "3", "Rubber": "4", "Gear": "5"}, "Light": {"Glass": "2", "Wire": "2"}, "Beacon": {"PowerCell": "10", "Jade": "1", "Ruby": "50"}, "Rocket": {"Pipe": "30", "Engine": "20"}, "Scrapper": {"Iron": "3", "Wire": "2"}}'

-- The original version of this code is made by skidrowmega. I will try to understand what this code does and add some comments to help me remember, and then improve then use it.
Beep(1)
local recipes = JSONDecode(json)
local craftingrequest = false
local craftingprocess = false
local keyboardinput = ""
local whitelist = {["pro123465"] = true, ["dira_diradira"] = true, ["XxgamergrannygirlxX"] = true}

local assemblers = GetPartsFromPort(1, "Assembler")
local bins = GetPartsFromPort(1, "Bin")
local materials = {}

function sortbins(preset) -- creates a list of materials that it has.
	materials = {} -- doing this is required since this is basically initializing.
	bins = GetPartsFromPort(1, "Bin") -- probably required if a bin has been taken off.
	for _, bin in pairs(bins) do
		local amount = bin:GetAmount()
		local material = bin:GetResource()
		if amount > 0 then
			if not materials[material] then -- if the table materials has nil in the value of the material variable as the key, then
				materials[material] = amount -- set the value in the material key to the amount of material the bin has
			else
				materials[material] += amount -- set the value in the material key to the amount of material this bin has + the other bin containing the same material
			end
		end
	end
	materials[preset] = materials[preset] or 0
end

function configassemblers(amount, text) -- configures amount of assemblers to assemble text, and configures the rest to assemble Iron which is impossible to do.
	for i, assembler in ipairs(assemblers) do
		if i <= amount then -- this is better than adding an i set to amount that gets decremented every time this is true
			assembler:Configure({ Assemble = text })
		else
			assembler:Configure({ Assemble = "Iron" })
		end
	end
end

function configfilters(amount, text) -- my first own function in this code! it configures amount of filters to assemble text, and configures the rest to filter blank which is nothing.
    --[[idea:   configfilters will config all filters connected to bins that has a material in it to the respective material
                it will then calculate the leftover space from all of the bins with the same material as the var text
                it will then calculate the amount of filters needed to be configured by:
                first subtracting the var amount by that leftover space
                then dividing by 1000 and ceiling it.
                after that it will look for filteramount of empty bins and configure that much filters.
                the rest is configured as ""
    ]]--
	print("configfilter run, with the inputs of " .. amount .. " and " .. text)
	local leftoverspace = math.abs((1000 - (materials[text] % 1000)) % 1000 )
	print(leftoverspace)
	local filterneeded = math.ceil((amount - leftoverspace) / 1000)
	print(filterneeded)

	for _, bin in ipairs(bins) do -- config za filters
		print("start for loop")
		if bin:GetAmount() > 0 then
			GetPartFromPort(bin, "Filter"):Configure({ Filter = bin:GetResource() })
			print("Bin is filled, also " .. bin:GetResource() .. " " .. JSONEncode(GetPartFromPort(bin, "Filter")))
		elseif filterneeded > 0 then
			GetPartFromPort(bin, "Filter"):Configure({ Filter = text })
			filterneeded -= 1
			print("there are " .. filterneeded .. " filters needed to be configured left, also " .. bin:GetResource() .. " " .. JSONEncode(GetPartFromPort(bin, "Filter")))
		else
			GetPartFromPort(bin, "Filter"):Configure({ Filter = "" })
			print("no filters needed")
		end
		task.wait()
	end
end

function makething(amount, material) -- Makes amount of materials you want to make. Uses recursion
	task.wait() -- waits so that no crashing i think
	local recipe = recipes[material] -- sets the recipe to the recipe from the recipes table with material as a key.
	sortbins(material)
	local amountonstart = materials[material]
	for i, v in pairs(recipe) do -- gets each amount of ingredient of the recipe
		v *= amount -- multiplies the amount of the ingredient with how much results it needs
		if not materials[i] then -- i have no idea if the i variable gives the key. i assume so because it uses pairs
			materials[i] = 0 -- if theres none of the aforementioned ingredient, it sets it to 0 in the materials table
		end
		if recipes[i] then -- if you can craft the ingredient, then it will do the funny recursion
			task.wait()
			makething(v, i)
		end
	end
	sortbins(material) -- for some reason this requires some delay or else it will make configfilters have a stroke or something idk
	task.wait(1)
	configfilters(amount, material)
	task.wait(1)
	print("Trying to craft: " .. amount .. " " .. material) -- debugging purposes i assume. in order to print it has to do the recursion thing first so it does this to basic things like wires first
	-- this is where it actually crafts. beware! a lotta weird things below.
	while not materials[material] or amount - (materials[material] - amountonstart) > 0 do -- while materials[material] is nil (impossible), or the amount of things you want to make isnt reached, do
		task.wait()
		print(amount - (materials[material] - amountonstart))
		configassemblers(amount - (materials[material] - amountonstart), material) -- configures a certain amount of assemblers
		sortbins(material) -- sort bins to see how much amount gotten from configured
	end
	print("Amount Crafted: " .. materials[material] - amountonstart) -- also debugging puposes
	configassemblers(0, "Iron") -- when crafting is finished, it configs nothing to iron, causing it to config everything to iron

end

local Screen = GetPartFromPort(1, 'TouchScreen')
local Keyboard = GetPartFromPort(1, 'Keyboard')
Screen:ClearElements()
Screen:CreateElement('TextLabel', {
	Position = UDim2.fromScale(0, 0),
	Size = UDim2.fromScale(1, 1),
	Text = "",
	BackgroundTransparency = 0,
	BackgroundColor3 = Color3.fromRGB(25, 25, 25)
})
local RequestButton = Screen:CreateElement('TextButton', {
	AnchorPoint = Vector2.new(0.5, 0.5),
	Position = UDim2.fromScale(0.5, 0.725),
	Size = UDim2.fromScale(0.5, 0.125),
	Text = "Craft",
	TextColor3 = Color3.fromRGB(255, 255, 255),
	BackgroundTransparency = 0,
	BackgroundColor3 = Color3.fromRGB(50, 50, 50)
})

local CancelButton = Screen:CreateElement('TextButton', {
	AnchorPoint = Vector2.new(0.5, 0.5),
	Position = UDim2.fromScale(0.5, 0.9),
	Size = UDim2.fromScale(0.5, 0.125),
	Text = "Turn Off Microcontroller",
	TextColor3 = Color3.fromRGB(255, 255, 255),
	BackgroundTransparency = 0,
	BackgroundColor3 = Color3.fromRGB(50, 0, 0)
})

local Display = Screen:CreateElement('TextLabel', {
	Position = UDim2.fromScale(0.5, 0.25),
	AnchorPoint = Vector2.new(0.5, 0.5),
	Size = UDim2.fromScale(0.9, 0.4),
	Text = "",
	TextColor3 = Color3.fromRGB(255, 255, 255),
	BackgroundTransparency = 0,
	BackgroundColor3 = Color3.fromRGB(10, 10, 10)
})

local Return = Screen:CreateElement('TextLabel', {
	Position = UDim2.fromScale(0.5, 0.56),
	AnchorPoint = Vector2.new(0.5, 0.5),
	Size = UDim2.fromScale(0.9, 0.125),
	Text = 'Format of input is "<amount> <item>"',
	TextColor3 = Color3.fromRGB(255, 255, 255),
	BackgroundTransparency = 1,
	BackgroundColor3 = Color3.fromRGB(50, 50, 50)
})

Keyboard:Connect("TextInputted", function(text, player)
	if whitelist[player] then
		Beep(1)
		keyboardinput = text:sub(1, -2)
		Display:ChangeProperties({
			Text = text:sub(1, -2)
		})
	end
end)

RequestButton.MouseButton1Click:Connect(function()
	print("Hey dude can i craft?")
	if not craftingprocess then
		print("Sure! Am not crafting rn")
		print("Can i craft " .. keyboardinput:split(" ")[1] .. " " .. keyboardinput:split(" ")[2])
		if recipes[keyboardinput:split(" ")[2]] then
			print("Okay sure i'll craft that")
			craftingrequest = true
		else
			print("I cant craft that, idk the recioe")
			Return:ChangeProperties({
				Text = "Error: recipes returned nil",
				TextColor3 = Color3.fromRGB(255, 0, 0)
			})
		end
	else
		print("Sorry, am still craftin")
		Return:ChangeProperties({
			Text = "Error: I'm still crafting " .. keyboardinput:split(" ")[1] .. " " .. keyboardinput:split(" ")[2],
			TextColor3 = Color3.fromRGB(255, 0, 0)
		})
	end
end)

CancelButton.MouseButton1Click:Connect(function()
	Screen:ClearElements()
	configassemblers(0, "Iron")
	Beep(1)
	TriggerPort(1)
end)

while task.wait() do
	if craftingrequest then
		Beep(1)
		craftingrequest = false
		craftingprocess = true
		Return:ChangeProperties({
			Text = "Crafting " .. keyboardinput:split(" ")[1] .. " " .. keyboardinput:split(" ")[2] .. "...",
			TextColor3 = Color3.fromRGB(0, 0, 255)
		})
		makething(keyboardinput:split(" ")[1], keyboardinput:split(" ")[2])
		Beep(1)
		craftingprocess = false
		Return:ChangeProperties({
			Text = "Successfully crafted " .. keyboardinput:split(" ")[1] .. " " .. keyboardinput:split(" ")[2] .. "!",
			TextColor3 = Color3.fromRGB(0, 255, 0)
		})
	end
end
